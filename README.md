# pianoman

Group project for CSCE 483 by Aaron Kutch, Austin Collier, Dillon Fisher, Jared Jones,
Luke Ledbetter, and Vaibhav Karanam.

## Structure

This repository is structured into different folders for different components

- The `music_ir` folder contains code for dealing with the intermediate representation for the
   music generated by the machine vision component and consumed by the hardware component

## Dependencies

The OMR requires opencv and the `tf-end-to-end` submodule. Run `git submodule update --init` to
initialize the `tf-end-to-end` git submodule. The "Dependencies" section in `tf-end-to-end`
describes how to install the needed dependencies, and this whole repository should be moved inside
the `python3_7_root` folder created by the process (or you must find some way to run this repository
with Python3.7). Ignore the rest that starts with cloning `tf-end-to-end`, because it is intended
only for standalone `tf-end-to-end`.

In case you can't find the custom branch of `tf-end-to-end` with the "Dependencies" section
required by this repository, it basically consists of setting up a virtual environment for Python3.7
from source, running `sudo apt install ffmpeg libsm6 libxext6 -y` to install obscure dependencies
for opencv, installing `tensorflow` 1.15.5, and installing `opencv-python` 4.5.1.48.

Finally, the OMR requires unzipping the semantic model from
https://grfia.dlsi.ua.es/primus/models/PrIMuS/Semantic-Model.zip and installing it into a
`tf-end-to-end/Models/` folder.

The MIDI converter requires a specific branch of `python-midi`.
```
git clone https://github.com/big-c-note/python-midi.git
cd python-midi
git checkout hotfix/fix-python2-print
# you may need `sudo apt-get install swig`
python setup.py install
# this should work as an example
mididump.py mary.mid
```

The hardware part requires `pip install adafruit-circuitpython-servokit`

## Running

# Take an image with the staff lines horizontal and in the middle with this script
# (or alternatively save an image to `omr/images/input.png`)
python hardware/camera_test.py

# run these
python omr/binarize.py
python omr/truncate.py
# ignore the load errors which are actually just warnings
python tf-end-to-end/ctc_predict.py -image ./omr/images/truncated.png -model ./tf-end-to-end/Models/semantic_model.meta -vocabulary ./tf-end-to-end/Data/vocabulary_semantic.txt > music_ir/ir_csv/input.txt
python music_ir/omr_to_csv.py
python hardware/pianoman.py
